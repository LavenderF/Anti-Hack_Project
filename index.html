<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>遗忘图书馆 — 逐字燃烧动画带火光</title>
<style>
  body {
    margin:0; padding:40px 20px 100px;
    background: #1c1c1c;
    color: #f0e6d2;
    font-family: 'Courier New', monospace;
    display: flex; flex-direction: column; align-items: center;
    min-height: 100vh;
    overflow-x: hidden;
    user-select: none;
  }
  h1 {
    margin-bottom: 10px;
  }
  textarea {
    width: 90%;
    max-width: 600px;
    height: 180px;
    padding: 15px;
    font-size: 16px;
    background: #2b2b2b;
    color: #f0e6d2;
    border: none;
    resize: none;
  }
  button {
    margin: 15px 10px 0 0;
    background: #ff5722;
    color: white;
    padding: 10px 22px;
    font-size: 16px;
    border: none;
    cursor: pointer;
    border-radius: 6px;
    transition: background 0.3s;
    position: relative;
  }
  button:hover {
    background: #e04e1f;
  }
  #futureMessage {
    margin-top: 25px;
    font-size: 16px;
    color: #aaa;
    max-width: 600px;
    text-align: center;
    white-space: pre-wrap;
  }
  #burnContainer p {
    margin: 6px 0;
    font-size: 18px;
    font-weight: bold;
  }
  #burnContainer p span {
    display: inline-block;
    position: relative;
  }
  /* 火光动画 */
  @keyframes fireGlow {
    0%, 100% { text-shadow: 
      0 0 6px #ff5722,
      0 0 10px #ff7043,
      0 0 18px #ff8a65,
      0 0 30px #ffab91; 
    }
    50% { text-shadow:
      0 0 12px #ff7043,
      0 0 20px #ff5722,
      0 0 25px #ff8a65,
      0 0 40px #ffab91;
    }
  }
  /* 燃烧中的字火光 */
  .burning {
    animation: fireGlow 1s infinite alternate;
  }
  /* 燃烧文字动画 */
  .burn-char {
    opacity: 1;
    filter: blur(0);
    transform: translate(0,0) rotate(0deg);
    transition: none;
  }
  /* 燃烧消失状态 */
  .burned {
    opacity: 0 !important;
    filter: blur(2px);
    pointer-events: none;
    transform: translate(0, 5px) rotate(20deg);
  }

  /* 底部哲思 */
  #philosophy {
    position: fixed;
    bottom: 20px;
    width: 100%;
    text-align: center;
    font-size: 14px;
    color: #999;
    font-style: italic;
    user-select: none;
    pointer-events: none;
    height: 20px;
    line-height: 20px;
  }
</style>
</head>
<body>

<h1>写下你想被遗忘的事</h1>
<textarea id="confession" placeholder="在这里写下……"></textarea>
<div>
  <button id="burnBtn" title="烧掉它">🔥 烧掉它</button>
  <button id="saveFutureBtn" title="写给未来">💌 写给未来</button>
</div>
<div id="futureMessage"></div>
<div id="burnContainer"></div>
<div id="philosophy"></div>

<script>
(() => {
  const area = document.getElementById('confession');
  const burnBtn = document.getElementById('burnBtn');
  const saveFutureBtn = document.getElementById('saveFutureBtn');
  const futureDiv = document.getElementById('futureMessage');
  const burnContainer = document.getElementById('burnContainer');
  const philosophy = document.getElementById('philosophy');

  // 哲思语录
  const quotes = [
    "失去未必是损耗，放下也可能是成全。",
    "每一次焚烧，都是新的开始。",
    "轻轻放下，是给自己最大的慈悲。",
    "记忆如灰烬，终会随风远去。",
    "痛苦不会永远停留，正如火焰终将熄灭。",
    "遗忘是一种温柔的解脱。",
    "允许自己放下，才能看见更远的风景。",
    "过去不再重来，未来从此展开。"
  ];
  let quoteIndex = 0;

  // 哲思轮播
  function showNextQuote(){
    philosophy.style.opacity = 0;
    setTimeout(() => {
      philosophy.textContent = quotes[quoteIndex];
      philosophy.style.opacity = 1;
      quoteIndex = (quoteIndex +1) % quotes.length;
    }, 800);
  }
  showNextQuote();
  setInterval(showNextQuote, 15000);

  // 恢复未来留言（sessionStorage，一次性）
  window.onload = () => {
    // 恢复未来留言
    const msg = sessionStorage.getItem('future');
    if (msg) {
      futureDiv.innerText = "📬 来自过去的你写道：\n" + msg;
      sessionStorage.removeItem('future');
    }
  };

  // 保存未来留言（一次性，sessionStorage）
  saveFutureBtn.onclick = () => {
    const msg = prompt("写一句话给未来的自己：");
    if (msg && msg.trim()) {
      sessionStorage.setItem('future', msg.trim());
      alert("✅ 已保存给未来的你。刷新或关闭页面后才会看到。");
    }
  };

  // 燃烧动画函数
  burnBtn.onclick = () => {
    if (area.style.display === 'none') return; // 防止重复点
    const text = area.value.trim();
    if (!text) return alert('请输入内容后再烧掉它。');
    burnBtn.disabled = true;
    saveFutureBtn.disabled = true;
    area.disabled = true;

    const lines = text.split('\n');
    area.style.display = 'none';
    burnContainer.innerHTML = '';

    // 每行分割成单字符span，添加燃烧初始样式
    lines.forEach(line => {
      const p = document.createElement('p');
      for (const ch of line) {
        const span = document.createElement('span');
        span.textContent = ch;
        span.classList.add('burn-char');
        p.appendChild(span);
      }
      burnContainer.appendChild(p);
    });

    const paragraphs = burnContainer.querySelectorAll('p');
    let lineIndex = 0;

    function burnLine() {
      if (lineIndex >= paragraphs.length) {
        // 全部烧完
        setTimeout(() => {
          burnContainer.innerHTML = '';
          futureDiv.innerText = "🕊️ 它已经不在这里了。你做得很好。";
          burnBtn.disabled = false;
          saveFutureBtn.disabled = false;
          area.value = '';
          area.style.display = 'block';
          area.disabled = false;
        }, 1000);
        return;
      }
      const spans = paragraphs[lineIndex].querySelectorAll('span');
      let charIndex = 0;

      function burnChar() {
        if (charIndex >= spans.length) {
          lineIndex++;
          setTimeout(burnLine, 400);
          return;
        }
        const span = spans[charIndex];
        span.classList.add('burning'); // 开始火光动画
        let opacity = 1;
        let frame = 0;

        function animate() {
          opacity -= 0.04;
          frame++;
          span.style.opacity = opacity;
          const shakeX = Math.sin(frame * 0.5) * 2 + 'px';
          const shakeY = Math.cos(frame * 0.3) * 1 + 'px';
          const rotateDeg = (frame * 5) % 360;
          const blurPx = (1 - opacity) * 3 + 'px';
          span.style.transform = `translate(${shakeX},${shakeY}) rotate(${rotateDeg}deg)`;
          span.style.filter = `blur(${blurPx})`;
          if (opacity <= 0) {
            span.style.display = 'none';
            span.classList.remove('burning');
            charIndex++;
            setTimeout(burnChar, 100);
          } else {
            requestAnimationFrame(animate);
          }
        }
        animate();
      }
      burnChar();
    }
    burnLine();
  };

})();
</script>

</body>
</html>

