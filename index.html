<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>çš±å·´çº¸æ–‡å­—æ…¢æ…¢çƒ§ç©¿æ´æ•ˆæœ</title>
<style>
  /* çš±å·´çº¸çº¹ç†èƒŒæ™¯ï¼Œåˆ©ç”¨SVGæ»¤é•œå™ªç‚¹å åŠ  */
  body {
    margin:0; padding:30px;
    background: #f9f5eb;
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    user-select:none;
    min-height: 100vh;
    overflow-x: hidden;
    color: #333;
  }
  /* çº¸å¼ çš±çº¹çº¹ç†èƒŒæ™¯å±‚ */
  #paper {
    position: fixed;
    top:0; left:0; right:0; bottom:0;
    pointer-events:none;
    background: repeating-radial-gradient(
      circle at center,
      #f9f5eb 0, #e8e1cd 1px, #f9f5eb 2px
    );
    filter: url(#noise);
    z-index: -1;
  }
  textarea {
    width: 100%;
    height: 120px;
    font-size: 28px;
    padding: 12px;
    border-radius: 8px;
    border: 1px solid #ccc;
    resize: vertical;
    margin-bottom: 15px;
  }
  #burnContainer {
    font-size: 36px;
    line-height: 1.4;
    white-space: pre-wrap;
    word-break: break-word;
    min-height: 140px;
    letter-spacing: 0.04em;
    user-select: none;
  }
  #burnContainer span {
    display: inline-block;
    position: relative;
    cursor: default;
    /* é®ç½©èµ·å§‹æ— æ´ï¼Œåé¢ç”¨JSæ§åˆ¶mask */
    -webkit-mask-image: none;
    mask-image: none;
  }
  button {
    padding: 12px 22px;
    font-size: 18px;
    margin-right: 10px;
    border-radius: 6px;
    border: none;
    cursor: pointer;
    background: #d35400;
    color: white;
    transition: background-color 0.3s ease;
  }
  button:disabled {
    background: #aaa;
    cursor: not-allowed;
  }
  button:hover:not(:disabled) {
    background: #e67e22;
  }
  #futureDiv {
    margin-top: 25px;
    font-size: 22px;
    color: #7f4e12;
    min-height: 50px;
  }
  /* ç²’å­æ ·å¼ */
  .particle {
    position: fixed;
    pointer-events: none;
    border-radius: 50%;
    opacity: 1;
    mix-blend-mode: screen;
  }
</style>
</head>
<body>

<div id="paper"></div>

<h2>çš±å·´çº¸ä¸Šæ–‡å­—æ…¢æ…¢çƒ§ç©¿æ´åŠ¨ç”»æ•ˆæœ</h2>
<textarea id="inputArea" placeholder="è¯·è¾“å…¥ä½ æƒ³ç‡ƒçƒ§çš„æ–‡å­—...">è¿™æ˜¯ä¸€å¼ çš±å·´çš„çº¸ï¼Œæ–‡å­—æ…¢æ…¢è¢«çƒ§ç©¿...</textarea><br />
<button id="burnBtn">å¼€å§‹ç‡ƒçƒ§ğŸ”¥</button>
<button id="saveFutureBtn" disabled>ä¿å­˜ç»“æœ</button>

<div id="burnContainer"></div>
<div id="futureDiv"></div>

<svg width="0" height="0">
  <filter id="noise" x="0" y="0" width="100%" height="100%">
    <feTurbulence id="turbulence" baseFrequency="0.07" numOctaves="3" stitchTiles="stitch" />
    <feDisplacementMap in="SourceGraphic" in2="turbulence" scale="10" xChannelSelector="R" yChannelSelector="G" />
  </filter>
</svg>

<script>
  const area = document.getElementById("inputArea");
  const burnBtn = document.getElementById("burnBtn");
  const saveFutureBtn = document.getElementById("saveFutureBtn");
  const burnContainer = document.getElementById("burnContainer");
  const futureDiv = document.getElementById("futureDiv");
  const paper = document.getElementById("paper");

  let toBurn = [];
  let burningIndex = 0;
  let baseDelay = 600; // åˆå§‹ç‡ƒçƒ§é—´éš” ms
  const minDelay = 100; // æœ€å¿«ç‡ƒçƒ§é—´éš”
  const acceleration = 0.75; // æ¯æ¬¡åŠ é€Ÿä¹˜æ•°ï¼ˆè¶Šå°åŠ é€Ÿè¶Šå¿«ï¼‰

  const particles = [];
  const particleColors = ["#e25822", "#f39c12", "#d35400", "#ff6f00"];
  const maxParticleSize = 7;

  // ç”¨äºç»™æ¯ä¸ªspanè®¾ç½®ä¸€ä¸ªé®ç½©idå’ŒSVGé®ç½©åœ†ï¼Œç”¨æ¥å®ç°æ´é€æ¸å˜å¤§æ•ˆæœ
  let maskDefs = null;

  function createParticle(x, y) {
    const p = document.createElement("div");
    p.className = "particle";
    p.style.backgroundColor = particleColors[Math.floor(Math.random() * particleColors.length)];
    const size = Math.random() * maxParticleSize + 3;
    p.style.width = size + "px";
    p.style.height = size + "px";
    p.style.left = x + "px";
    p.style.top = y + "px";
    p.vx = (Math.random() - 0.5) * 2;
    p.vy = -Math.random() * 3 - 1;
    p.life = 40 + Math.random() * 20;
    p.style.opacity = 1;
    document.body.appendChild(p);
    particles.push(p);
  }

  function animateParticles() {
    for(let i = particles.length - 1; i >= 0; i--) {
      const p = particles[i];
      p.life--;
      if (p.life <= 0) {
        p.remove();
        particles.splice(i,1);
        continue;
      }
      p.vx *= 0.95;
      p.vy += 0.1;
      let left = parseFloat(p.style.left);
      let top = parseFloat(p.style.top);
      left += p.vx;
      top += p.vy;
      p.style.left = left + "px";
      p.style.top = top + "px";
      p.style.opacity = p.life / 60;
    }
    if(particles.length > 0){
      requestAnimationFrame(animateParticles);
    }
  }

  // ç”ŸæˆSVGé®ç½©å®šä¹‰èŠ‚ç‚¹
  function setupMasks(){
    let svgNS = "http://www.w3.org/2000/svg";
    let svg = document.createElementNS(svgNS,"svg");
    svg.style.position = "absolute";
    svg.style.width = 0; svg.style.height = 0;
    svg.style.overflow = "visible";
    svg.setAttribute("aria-hidden","true");

    maskDefs = document.createElementNS(svgNS,"defs");
    svg.appendChild(maskDefs);
    document.body.appendChild(svg);
  }

  function createMask(id, cx, cy, r){
    let svgNS = "http://www.w3.org/2000/svg";
    let mask = document.createElementNS(svgNS,"mask");
    mask.setAttribute("id", id);

    let rect = document.createElementNS(svgNS,"rect");
    rect.setAttribute("x",0);
    rect.setAttribute("y",0);
    rect.setAttribute("width","100%");
    rect.setAttribute("height","100%");
    rect.setAttribute("fill","white");
    mask.appendChild(rect);

    let circle = document.createElementNS(svgNS,"circle");
    circle.setAttribute("cx", cx);
    circle.setAttribute("cy", cy);
    circle.setAttribute("r", r);
    circle.setAttribute("fill", "black"); // é»‘è‰²åŒºåŸŸä¼šè¢«é®æŒ¡
    circle.style.transition = "r 0.3s linear";
    mask.appendChild(circle);

    maskDefs.appendChild(mask);
    return {mask, circle};
  }

  // æ´—ç‰Œç®—æ³•
  function shuffleArray(array){
    for(let i=array.length-1; i>0; i--){
      const j = Math.floor(Math.random()*(i+1));
      [array[i], array[j]] = [array[j], array[i]];
    }
  }

  burnBtn.onclick = () => {
    burnBtn.disabled = true;
    saveFutureBtn.disabled = true;
    futureDiv.innerText = "";
    burnContainer.innerHTML = "";

    const text = area.value;
    if(!text.trim()){
      alert("è¯·è¾“å…¥ä¸€äº›æ–‡å­—");
      burnBtn.disabled = false;
      return;
    }
    toBurn = [];

    // æ¸…é™¤æ—§çš„svg defs
    if(maskDefs){
      while(maskDefs.firstChild) maskDefs.removeChild(maskDefs.firstChild);
    }else{
      setupMasks();
    }

    for(let ch of text){
      const span = document.createElement("span");
      span.innerText = ch;
      span.style.webkitMaskImage = "none";
      span.style.maskImage = "none";
      burnContainer.appendChild(span);
      toBurn.push({span});
    }

    // ç»™æ¯ä¸ªspanåˆ›å»ºå¯¹åº”çš„mask
    toBurn.forEach((item, idx) => {
      // è·å–spanç›¸å¯¹äºé¡µé¢ä½ç½®ä¸­å¿ƒç‚¹
      let rect = item.span.getBoundingClientRect();
      // ä½¿ç”¨ç™¾åˆ†æ¯”åæ ‡maskä¸å‡†ï¼Œæ”¹æˆå›ºå®šåƒç´ 
      // åˆ›å»ºä¸€ä¸ªå”¯ä¸€ID
      let id = "mask-burn-" + idx + "-" + Date.now();
      let cx = rect.width / 2;
      let cy = rect.height / 2;
      let maskObj = createMask(id, cx, cy, 0);
      item.mask = maskObj.mask;
      item.circle = maskObj.circle;
      item.cx = cx;
      item.cy = cy;
      item.r = 0;
      item.span.style.webkitMaskImage = `url(#${id})`;
      item.span.style.maskImage = `url(#${id})`;
      // maskåæ ‡ä¼šç›¸å¯¹äºspanæœ¬èº«ï¼Œcircle cx/cyç”¨spanå†…åæ ‡ä¸­å¿ƒ
      item.span.style.webkitMaskRepeat = "no-repeat";
      item.span.style.maskRepeat = "no-repeat";
      item.span.style.webkitMaskPosition = "center";
      item.span.style.maskPosition = "center";
      item.span.style.webkitMaskSize = "100% 100%";
      item.span.style.maskSize = "100% 100%";
    });

    burningIndex = 0;
    baseDelay = 600;
    shuffleArray(toBurn);

    area.style.display = "none";

    burnNext();
  };

  function burnNext(){
    if(burningIndex >= toBurn.length){
      setTimeout(() => {
        burnContainer.innerHTML = '';
        futureDiv.innerText = "ğŸ•Šï¸ æ–‡å­—å·²æ…¢æ…¢è¢«çƒ§ç©¿æ¶ˆå¤±ã€‚ä½ åšå¾—å¾ˆå¥½ã€‚";
        burnBtn.disabled = false;
        saveFutureBtn.disabled = false;
        area.value = '';
        area.style.display = 'block';
        area.disabled = false;
      }, 1500);
      return;
    }
    const item = toBurn[burningIndex];
    burningIndex++;

    let rect = item.span.getBoundingClientRect();
    for(let i=0; i<5; i++){
      createParticle(rect.left + rect.width/2, rect.top + rect.height/2);
    }
    if(particles.length > 0) animateParticles();

    let radius = 0;
    const maxRadius = Math.max(rect.width, rect.height) * 0.9;
    const step = maxRadius / 30;
    function animate(){
      radius += step;
      if(radius >= maxRadius){
        radius = maxRadius;
      }
      item.circle.setAttribute("r", radius);
      if(radius >= maxRadius){
        // å˜ä¸ºé€æ˜ä½†å ä½ï¼Œç§»é™¤é®ç½©ï¼ˆå³å­—æ¶ˆå¤±ä½†å ä½ï¼‰
        item.span.style.visibility = 'hidden';
        item.span.style.opacity = 0;
        item.span.style.pointerEvents = 'none';
        // ç§»é™¤maské®ç½©ï¼Œè®©å­—æ¯å½»åº•çœ‹ä¸è§ï¼ˆå› ä¸ºmaskæ˜¯é»‘æ´ï¼‰
        item.span.style.webkitMaskImage = "none";
        item.span.style.maskImage = "none";

        baseDelay = Math.max(minDelay, baseDelay * acceleration);
        setTimeout(burnNext, baseDelay);
      } else {
        requestAnimationFrame(animate);
      }
    }
    animate();
  }

  saveFutureBtn.onclick = () => {
    const text = burnContainer.innerText;
    navigator.clipboard.writeText(text).then(() => {
      alert("ç‡ƒçƒ§åçš„æ–‡å­—å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼");
    }).catch(() => {
      alert("å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ï¼");
    });
  };
</script>

</body>
</html>
