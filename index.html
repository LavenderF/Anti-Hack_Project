<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>遗忘图书馆</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: url('https://www.transparenttextures.com/patterns/paper-fibers.png') repeat #f7f2e8;
      font-family: "Georgia", serif;
      height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    h1 {
      font-size: 3em;
      color: #4a3628;
      margin-bottom: 20px;
    }

    textarea {
      width: 90%;
      max-width: 600px;
      height: 140px;
      padding: 16px;
      border-radius: 12px;
      border: none;
      background: #fffaf3 url('https://www.transparenttextures.com/patterns/crissxcross.png');
      font-size: 18px;
      color: #333;
      resize: vertical;
      box-shadow: 0 0 15px rgba(255, 100, 0, 0.6), 0 0 30px rgba(255, 140, 0, 0.4);
      animation: flicker 1.5s infinite alternate;
      border-left: 4px solid rgba(255, 80, 0, 0.5);
      border-right: 4px solid rgba(255, 80, 0, 0.5);
    }

    @keyframes flicker {
      from {
        box-shadow: 0 0 10px rgba(255, 100, 0, 0.3), 0 0 20px rgba(255, 140, 0, 0.2);
      }
      to {
        box-shadow: 0 0 20px rgba(255, 120, 0, 0.6), 0 0 40px rgba(255, 160, 0, 0.4);
      }
    }

    button {
      margin-top: 16px;
      padding: 12px 24px;
      font-size: 16px;
      border: none;
      border-radius: 6px;
      background-color: #a14c2e;
      color: white;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    button:hover {
      background-color: #bf6144;
    }

    canvas {
      position: absolute;
      top: 0;
      left: 0;
      z-index: -1;
    }

    #output {
      font-size: 36px;
      color: #2c1d12;
      white-space: pre-wrap;
      text-align: center;
      max-width: 80%;
      line-height: 1.5;
      margin-top: 40px;
    }

    #footer {
      position: absolute;
      bottom: 20px;
      font-size: 20px;
      color: #6a4d32;
    }
  </style>
</head>
<body>
  <h1>遗忘图书馆</h1>
  <textarea id="text" placeholder="输入一段想要焰烧的话..."></textarea>
  <button onclick="startBurning()">开始烧化</button>
  <div id="output"></div>
  <canvas id="fireCanvas"></canvas>
  <div id="footer">过去从未逝去，它甚至从未过去。</div>

  <script>
    const canvas = document.getElementById('fireCanvas');
    const ctx = canvas.getContext('2d');
    const output = document.getElementById('output');
    const textInput = document.getElementById('text');

    let chars = [];
    let burnTimer = 0;
    let particles = [];

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }

    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    function startBurning() {
      output.innerHTML = '';
      chars = [];
      const text = textInput.value;
      if (!text) return;

      for (let ch of text) {
        const span = document.createElement('span');
        span.textContent = ch;
        output.appendChild(span);
        chars.push({ el: span, life: 1, burned: false });
      }
      burnTimer = 0;
      particles = [];
      requestAnimationFrame(burnLoop);
    }

    function burnLoop() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      burnTimer++;
      let progress = Math.min(1, burnTimer / 400);

      for (let i = 0; i < chars.length; i++) {
        let char = chars[i];
        if (!char.burned && Math.random() < progress * 0.07) {
          char.life = 100;
          char.burned = true;
        }
        if (char.life > 0) {
          char.life--;
          let rect = char.el.getBoundingClientRect();
          drawFire(rect.left + rect.width / 2, rect.top + rect.height / 2, char.life);
          particles.push(createParticle(rect.left + rect.width / 2, rect.top + rect.height / 2));
          if (char.life === 0) {
            char.el.style.opacity = '0';
            char.el.style.textShadow = '0 0 4px rgba(0,0,0,0.2)';
          }
        }
      }

      updateParticles();

      if (chars.some(c => c.life > 0) || particles.length > 0) requestAnimationFrame(burnLoop);
    }

    function drawFire(x, y, life) {
      const intensity = Math.max(0, life / 100);
      const size = 20 + 20 * intensity;
      const gradient = ctx.createRadialGradient(x, y, 0, x, y, size);
      gradient.addColorStop(0, `rgba(255, ${100 + life}, 0, ${intensity})`);
      gradient.addColorStop(1, 'rgba(0,0,0,0)');
      ctx.fillStyle = gradient;
      ctx.beginPath();
      ctx.arc(x, y, size, 0, Math.PI * 2);
      ctx.fill();
    }

    function createParticle(x, y) {
      return {
        x,
        y,
        vx: (Math.random() - 0.5) * 1.5,
        vy: -Math.random() * 1.5,
        alpha: 1.0,
        radius: Math.random() * 3 + 1
      };
    }

    function updateParticles() {
      for (let i = particles.length - 1; i >= 0; i--) {
        const p = particles[i];
        p.x += p.vx;
        p.y += p.vy;
        p.alpha -= 0.02;
        if (p.alpha <= 0) {
          particles.splice(i, 1);
          continue;
        }
        ctx.fillStyle = `rgba(255, 150, 0, ${p.alpha})`;
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
        ctx.fill();
      }
    }
  </script>
</body>
</html>
