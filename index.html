<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>é—å¿˜å›¾ä¹¦é¦† | The Library of Letting Go</title>
<style>
  :root {
    --bg-color: #1c1c1c;
    --text-color: #f0e6d2;
    --textarea-bg: #2b2b2b;
    --button-bg: #ff5722;
    --button-hover: #e04e1f;
  }
  body {
    margin:0; min-height:100vh; display:flex; flex-direction:column; align-items:center; justify-content:center;
    background: var(--bg-color);
    color: var(--text-color);
    font-family: 'Courier New', monospace;
    overflow: hidden;
    padding: 60px 20px 100px;
    transition: background 0.6s, color 0.6s;
  }
  h1 {
    font-size: 26px;
    margin-bottom: 10px;
  }
  textarea {
    width: 90%;
    max-width: 600px;
    height: 180px;
    padding: 15px;
    font-size: 16px;
    background: var(--textarea-bg);
    color: var(--text-color);
    border: none;
    resize: none;
    transition: background 0.5s, color 0.5s;
  }
  button {
    margin: 15px 10px 0 0;
    background: var(--button-bg);
    color: white;
    padding: 10px 22px;
    font-size: 16px;
    border: none;
    cursor: pointer;
    border-radius: 6px;
    transition: background 0.3s;
  }
  button:hover {
    background: var(--button-hover);
  }
  #futureMessage {
    margin-top: 25px;
    font-size: 16px;
    color: #aaa;
    white-space: pre-wrap;
    max-width: 600px;
    text-align: center;
  }
  #burnContainer p {
    margin: 4px 0;
    opacity: 1;
    transition: opacity 0.4s ease-in-out, transform 0.4s ease-in-out;
  }
  #burnContainer p.burned {
    opacity: 0;
    transform: scale(0.95);
  }
  #philosophy {
    position: fixed;
    bottom: 20px;
    width: 100%;
    text-align: center;
    font-size: 14px;
    color: #999;
    font-style: italic;
    user-select: none;
    pointer-events: none;
    height: 20px;
    line-height: 20px;
  }
  #themeToggle {
    position: fixed;
    top: 20px;
    right: 20px;
    background: var(--button-bg);
    border-radius: 50%;
    width: 38px;
    height: 38px;
    font-size: 20px;
    line-height: 38px;
    text-align: center;
    cursor: pointer;
    user-select: none;
    transition: background 0.3s;
  }
  #themeToggle:hover {
    background: var(--button-hover);
  }
  /* Dream Theme */
  body.dream {
    --bg-color: #0b0f1a;
    --text-color: #a0c0f0;
    --textarea-bg: #15203b;
    --button-bg: #3a80ff;
    --button-hover: #2a62cc;
  }
  /* Canvas full screen */
  #ashCanvas {
    position: fixed;
    top:0; left:0; width:100vw; height:100vh;
    pointer-events: none;
    z-index: 10;
  }
</style>
</head>
<body>

<h1>å†™ä¸‹ä½ æƒ³è¢«é—å¿˜çš„äº‹</h1>
<textarea id="confession" placeholder="åœ¨è¿™é‡Œå†™ä¸‹â€¦â€¦"></textarea>
<div>
  <button id="burnBtn" title="çƒ§æ‰å®ƒ">ğŸ”¥ çƒ§æ‰å®ƒ</button>
  <button id="saveFutureBtn" title="å†™ç»™æœªæ¥">ğŸ’Œ å†™ç»™æœªæ¥</button>
</div>
<div id="futureMessage"></div>
<div id="burnContainer"></div>
<div id="philosophy"></div>
<div id="themeToggle" title="åˆ‡æ¢æ¢¦å¢ƒæ¨¡å¼">ğŸŒ™</div>
<canvas id="ashCanvas"></canvas>

<script>
(() => {
  const area = document.getElementById('confession');
  const burnBtn = document.getElementById('burnBtn');
  const saveFutureBtn = document.getElementById('saveFutureBtn');
  const futureDiv = document.getElementById('futureMessage');
  const burnContainer = document.getElementById('burnContainer');
  const philosophy = document.getElementById('philosophy');
  const themeToggle = document.getElementById('themeToggle');
  const ashCanvas = document.getElementById('ashCanvas');
  const ctx = ashCanvas.getContext('2d');
  
  // è‡ªåŠ¨æ¶ˆå¤±è®¡æ—¶ï¼ˆ30ç§’ï¼‰
  let autoTimer = null;

  // å“²æ€è¯­å½•
  const quotes = [
    "å¤±å»æœªå¿…æ˜¯æŸè€—ï¼Œæ”¾ä¸‹ä¹Ÿå¯èƒ½æ˜¯æˆå…¨ã€‚",
    "æ¯ä¸€æ¬¡ç„šçƒ§ï¼Œéƒ½æ˜¯æ–°çš„å¼€å§‹ã€‚",
    "è½»è½»æ”¾ä¸‹ï¼Œæ˜¯ç»™è‡ªå·±æœ€å¤§çš„æ…ˆæ‚²ã€‚",
    "è®°å¿†å¦‚ç°çƒ¬ï¼Œç»ˆä¼šéšé£è¿œå»ã€‚",
    "ç—›è‹¦ä¸ä¼šæ°¸è¿œåœç•™ï¼Œæ­£å¦‚ç«ç„°ç»ˆå°†ç†„ç­ã€‚",
    "é—å¿˜æ˜¯ä¸€ç§æ¸©æŸ”çš„è§£è„±ã€‚",
    "å…è®¸è‡ªå·±æ”¾ä¸‹ï¼Œæ‰èƒ½çœ‹è§æ›´è¿œçš„é£æ™¯ã€‚",
    "è¿‡å»ä¸å†é‡æ¥ï¼Œæœªæ¥ä»æ­¤å±•å¼€ã€‚"
  ];
  let quoteIndex = 0;

  // å“²æ€è½®æ’­
  function showNextQuote(){
    philosophy.style.opacity = 0;
    setTimeout(() => {
      philosophy.textContent = quotes[quoteIndex];
      philosophy.style.opacity = 1;
      quoteIndex = (quoteIndex +1) % quotes.length;
    }, 1000);
  }
  showNextQuote();
  setInterval(showNextQuote, 15000);

  // æ¢å¤æœªæ¥ç•™è¨€ï¼ˆsessionStorageï¼Œä¸€æ¬¡æ€§ï¼‰
  window.onload = () => {
    ashCanvas.width = window.innerWidth;
    ashCanvas.height = window.innerHeight;
    // æ¢å¤æœªæ¥ç•™è¨€
    const msg = sessionStorage.getItem('future');
    if (msg) {
      futureDiv.innerText = "ğŸ“¬ æ¥è‡ªè¿‡å»çš„ä½ å†™é“ï¼š\n" + msg;
      sessionStorage.removeItem('future');
    }
    resetAutoTimer();
    drawAsh(); // å¯åŠ¨ç°çƒ¬åŠ¨ç”»
  };
  window.onresize = () => {
    ashCanvas.width = window.innerWidth;
    ashCanvas.height = window.innerHeight;
  };

  // è‡ªåŠ¨çƒ§æ¯
  function autoBurn() {
    if (area.value.trim() !== '') {
      burnText();
    }
  }

  // ç„šçƒ§åŠ¨ç”»
  function burnText() {
    if (area.style.display === 'none') return; // é¿å…å¤šæ¬¡è§¦å‘
    clearTimeout(autoTimer);
    burnBtn.disabled = true;
    saveFutureBtn.disabled = true;
    area.disabled = true;

    const lines = area.value.trim().split('\n');
    area.style.display = 'none';
    burnContainer.innerHTML = '';

    // åˆ›å»ºè¡Œå…ƒç´ 
    lines.forEach(line => {
      const p = document.createElement('p');
      p.textContent = line;
      burnContainer.appendChild(p);
    });

    // ä¸€è¡Œè¡Œç‡ƒçƒ§
    const paragraphs = burnContainer.querySelectorAll('p');
    paragraphs.forEach((p,i) => {
      setTimeout(() => {
        p.classList.add('burned');
        if(i === paragraphs.length -1){
          // ç„šçƒ§å®Œæ¯•
          setTimeout(() => {
            burnContainer.innerHTML = '';
            futureDiv.innerText = "ğŸ•Šï¸ å®ƒå·²ç»ä¸åœ¨è¿™é‡Œäº†ã€‚ä½ åšå¾—å¾ˆå¥½ã€‚";
            burnBtn.disabled = false;
            saveFutureBtn.disabled = false;
            area.value = '';
            area.style.display = 'block';
            area.disabled = false;
            resetAutoTimer();
          }, 1200);
        }
      }, i * 300);
    });
  }

  // è¾“å…¥æ—¶é‡ç½®è®¡æ—¶
  area.addEventListener('input', resetAutoTimer);
  function resetAutoTimer(){
    clearTimeout(autoTimer);
    autoTimer = setTimeout(autoBurn, 30000);
  }

  // ä¿å­˜æœªæ¥ç•™è¨€ï¼ˆä¸€æ¬¡æ€§ï¼ŒsessionStorageï¼‰
  saveFutureBtn.onclick = () => {
    const msg = prompt("å†™ä¸€å¥è¯ç»™æœªæ¥çš„è‡ªå·±ï¼š");
    if (msg && msg.trim()) {
      sessionStorage.setItem('future', msg.trim());
      alert("âœ… å·²ä¿å­˜ç»™æœªæ¥çš„ä½ ã€‚åˆ·æ–°æˆ–å…³é—­é¡µé¢åæ‰ä¼šçœ‹åˆ°ã€‚");
    }
  };

  // ç‚¹å‡»çƒ§æ¯
  burnBtn.onclick = burnText;

  // === ç°çƒ¬ç²’å­åŠ¨ç”»å®ç° ===
  const ashes = [];
  class Ash {
    constructor() {
      this.x = Math.random() * ashCanvas.width;
      this.y = ashCanvas.height + 10 + Math.random()*50;
      this.vx = (Math.random()-0.5)*0.4;
      this.vy = - (1 + Math.random()*1);
      this.size = 1 + Math.random()*2;
      this.alpha = 1;
      this.life = 0;
      this.maxLife = 60 + Math.random()*40;
    }
    update() {
      this.x += this.vx;
      this.y += this.vy;
      this.life++;
      this.alpha = 1 - this.life / this.maxLife;
      if (this.alpha < 0) this.alpha = 0;
    }
    draw(ctx) {
      ctx.fillStyle = `rgba(200,200,200,${this.alpha})`;
      ctx.beginPath();
      ctx.ellipse(this.x, this.y, this.size, this.size*0.4, 0, 0, 2*Math.PI);
      ctx.fill();
    }
  }
  function drawAsh() {
    ctx.clearRect(0, 0, ashCanvas.width, ashCanvas.height);

    // æ–°å¢ç°çƒ¬æ¦‚ç‡
    if (Math.random() < 0.3) {
      ashes.push(new Ash());
    }

    for(let i = ashes.length -1; i >= 0; i--) {
      ashes[i].update();
      ashes[i].draw(ctx);
      if (ashes[i].alpha <= 0) ashes.splice(i, 1);
    }

    requestAnimationFrame(drawAsh);
  }

  // === ä¸»é¢˜åˆ‡æ¢ ===
  let isDream = false;
  themeToggle.onclick = () => {
    isDream = !isDream;
    if (isDream) {
      document.body.classList.add('dream');
      themeToggle.textContent = 'â˜€ï¸';
      philosophy.textContent = "è¿›å…¥æ¢¦å¢ƒæ¨¡å¼ï¼Œæ„¿ä½ å®‰ç„¶å…¥ç¡ã€‚";
    } else {
      document.body.classList.remove('dream');
      themeToggle.textContent = 'ğŸŒ™';
      showNextQuote();
    }
  };

})();
</script>

</body>
</html>
